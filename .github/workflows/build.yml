name: BuildGalileo
on:
  push:
    branches: [ main ]
    paths-ignore:
      - conda/**
      - docker/**
      - docs/**
      - examples/**
      - testdata/**
  pull_request:
    branches: [ main ]
    paths-ignore:
      - conda/**
      - docker/**
      - docs/**
      - examples/**
      - testdata/**
  workflow_dispatch:

jobs:
  build_and_test:
    name: build and test Galileo in docker container
    runs-on: ubuntu-latest
    container: jdgalileo/galileo:devel-cpu
    steps:
      - name: check out code
        uses: actions/checkout@v2
        with:
          ref: JDGalileo-patch-1
          submodules: true
      - name: build
        run: |
          source ./docker/env.sh
          python3 setup.py build
          python3 setup.py install
      - name: test
        run: |
          source ./docker/env.sh
          bash ./galileo/tests/run_tests.sh
